import os
import requests
import sys

def check_directories(domain, wordlist):
    try:
        with open(wordlist, 'r') as f:
            directories = f.read().splitlines()  # Lit les entrées de la wordlist ligne par ligne.
    except FileNotFoundError:
        print("Wordlist not found.")  # Gère l'exception si le fichier n'est pas trouvé.
        sys.exit(1)  # Quitte le programme avec un code d'erreur.

    # Vérifie si le domaine est dans un format correct.
    if not domain.startswith("http://") and not domain.startswith("https://"):
        print("Invalid domain format. Please enter the domain in the format: http://host/ or https://host/")
        sys.exit(1)  # Quitte le programme si le format du domaine est incorrect.

    total_subdomains = len(directories)  # Nombre total de répertoires à tester.
    tested_subdomains = 0  # Compteur pour les répertoires déjà testés.

    for directory in directories:
        dir_url = f"{domain}/{directory}"  # Construit l'URL pour le répertoire courant.
        tested_subdomains += 1
        completion_percentage = (tested_subdomains / total_subdomains) * 100  # Calcul du pourcentage d'achèvement.
        os.system('cls' if os.name == 'nt' else 'clear')  # Efface la console pour afficher l'avancement.
        print(f"Test en cours : {completion_percentage:.2f}%")  # Affiche le pourcentage de progression.
        print(f"Sous-domaines testés : {dir_url}\n{tested_subdomains}/{total_subdomains}")

        try:
            response = requests.get(dir_url)  # Effectue une requête GET sur l'URL.
            if response.status_code == 200:
                print("Valid directory:", dir_url)  # Répertoire trouvé et accessible.
            elif response.status_code == 404:
                pass  # Répertoire non trouvé, ne fait rien.
            else:
                print("Error accessing directory:", dir_url)  # Autres erreurs HTTP.
        except requests.ConnectionError:
            print("Connection error while accessing directory:", dir_url)  # Erreur de connexion.

def main():
    # Vérification des arguments du programme pour utiliser le script correctement.
    if len(sys.argv) != 2 and len(sys.argv) != 3:
        print("Usage: python DirEnum.py <domain> [<wordlist_file>]")
        sys.exit(1)

    domain = sys.argv[1]  # Le domaine à tester.

    if len(sys.argv) == 3:
        wordlist = sys.argv[2]  # Utilise la wordlist spécifiée par l'utilisateur.
    elif len(sys.argv) == 2:
        wordlist = "/usr/share/wordlists/dirb/common.txt"  # Utilise une wordlist par défaut.

    check_directories(domain, wordlist)  # Appelle la fonction de vérification des répertoires.

if __name__ == "__main__":
    main()  # Exécute la fonction principale si le script est lancé directement.
