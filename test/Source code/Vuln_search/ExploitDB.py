import subprocess
import json

def search_exploit(service):
    commande = ['searchsploit', '-j','-w', service]
    resultat = subprocess.run(commande, capture_output=True, text=True)
    Service = service.replace(' ','')
    if resultat.returncode == 0:
        try:
            resultat_json = json.loads(resultat.stdout)
        except json.JSONDecodeError as e:
            print_red(f"Erreur lors de l'analyse de la sortie JSON : {e}")
    else:
        print_red(f"La commande a échoué avec le code de sortie {resultat.returncode}")

    path = f'./Doc/Report/JSON/Exploits/{service}.json'
    if resultat_json:
        with open(path, 'w') as f:
            json.dump(resultat_json, f, indent=4)
    else:
        print_red("La recherche de vulnérabilités a échoué.")


